{% extends "my_canteen/base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <div class="orders-header">
    <h2>ðŸ§¾ My Orders</h2>
    <p class="muted">Track your orders in real-time and cancel if needed (before preparing).</p>
  </div>

  {% if orders %}
  <div class="card surface">
    <table class="orders-table pretty">
      <thead>
        <tr>
          <th>#</th>
          <th>Placed</th>
          <th>Items</th>
          <th>Total</th>
          <th>Payment</th>
          <th>Status</th>
          <th class="actions-col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>#{{ o.id }}</td>

          <td>
            <div class="when">
              {{ o.created_at|date:"M d, Y" }}
              <div class="sub">{{ o.created_at|date:"H:i a" }}</div>
            </div>
          </td>

          <td>
            {% for it in o.orderitem_set.all %}
              <div class="order-line">
                <span class="dot"></span>
                {{ it.item.name }} Ã— {{ it.quantity }}
              </div>
            {% endfor %}
          </td>

          <td><strong>{{ o.total_price }} Tk</strong></td>

          <td>
            {% if o.payment_status == 'paid' %}
              <span class="badge success">Paid</span>
            {% else %}
              <span class="badge warn">Unpaid</span>
            {% endif %}
          </td>

          <td>
            {% if o.status == 'pending' %}
              <span class="badge gray">Pending</span>
            {% elif o.status == 'accepted' %}
              <span class="badge info">Accepted</span>
            {% elif o.status == 'preparing' %}
              <span class="badge primary">Preparing</span>
            {% elif o.status == 'ready' %}
              <span class="badge violet">Ready</span>
            {% elif o.status == 'delivered' %}
              <span class="badge blue">Delivered</span>
            {% elif o.status == 'completed' %}
              <span class="badge success">Completed</span>
            {% else %}
              <span class="badge danger">Cancelled</span>
            {% endif %}
          </td>

          <td class="actions">
            {% if o.id in cancelable_ids %}
              <form method="post" action="{% url 'user_order_cancel' o.id %}">
                {% csrf_token %}
                <button class="btn btn-soft-danger" onclick="return confirm('Cancel this order?');">
                  Cancel
                </button>
              </form>
            {% else %}
              <button class="btn btn-soft" disabled>Cancel</button>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <div class="empty-state">
      <img src="{% static 'my_canteen/images/empty-box.svg' %}" alt="" />
      <h3>No orders yet</h3>
      <p>Browse the menu and place your first order.</p>
      <a href="{% url 'menu' %}" class="btn">Go to Menu</a>
    </div>
  {% endif %}
</div>
{% endblock %}
