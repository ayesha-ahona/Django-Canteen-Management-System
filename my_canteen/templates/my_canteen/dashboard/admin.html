{% extends "my_canteen/base.html" %}

{% block content %}
<style>
/* Force tab content visibility */
.tab-content {
    display: none !important;
    padding: 20px;
    background: white;
    border-radius: 8px;
    margin-top: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.tab-content.active {
    display: block !important;
}

.tab-btn.active {
    background: #d32f2f !important;
    color: #fff !important;
}
</style>

<h2>{{ dashboard_title|default:"ğŸ› ï¸ Admin Dashboard" }}</h2>

<div class="dashboard-tabs">
  <button class="tab-btn active" onclick="showTab('orders')">ğŸ“¦ Orders</button>
  <button class="tab-btn" onclick="showTab('menu')">ğŸ“‹ Menu</button>
  <button class="tab-btn" onclick="showTab('stock')">ğŸ“¦ Stock</button>
  <button class="tab-btn" onclick="showTab('reports')">ğŸ“Š Reports</button>
  <button class="tab-btn" onclick="showTab('profile')">ğŸ‘¤ Profile</button>
</div>

<div id="orders" class="tab-content active">
  <h3>All Orders</h3>
  <table class="orders-table">
    <tr>
      <th>#</th><th>User</th><th>Items</th><th>Total</th><th>Payment</th><th>Status</th><th>Actions</th>
    </tr>
    {% for order in orders %}
    <tr>
      <td>#{{ order.id }}</td>
      <td>{{ order.user.username }}</td>
      <td>
        {% for oi in order.orderitem_set.all %}
          {{ oi.item.name }} x {{ oi.quantity }} <br>
        {% endfor %}
      </td>
      <td>{{ order.total_price }} Tk</td>
      <td>{{ order.payment_status|capfirst }}</td>
      <td class="status {{ order.status }}">{{ order.status }}</td>
      <td>
        <form method="post" action="{% url 'order_accept' order.id %}" style="display:inline;">{% csrf_token %}<button class="btn">Accept</button></form>
        <form method="post" action="{% url 'order_preparing' order.id %}" style="display:inline;">{% csrf_token %}<button class="btn">Preparing</button></form>
        <form method="post" action="{% url 'order_ready' order.id %}" style="display:inline;">{% csrf_token %}<button class="btn">Ready</button></form>
        <form method="post" action="{% url 'order_delivered' order.id %}" style="display:inline;">{% csrf_token %}<button class="btn">Delivered</button></form>
        <form method="post" action="{% url 'order_mark_paid' order.id %}" style="display:inline;">{% csrf_token %}<button class="btn">Mark Paid</button></form>
        <form method="post" action="{% url 'order_completed' order.id %}" style="display:inline;">{% csrf_token %}<button class="btn">Complete</button></form>
        <form method="post" action="{% url 'order_cancel' order.id %}" style="display:inline;">{% csrf_token %}<button class="btn">Cancel</button></form>
      </td>
    </tr>
    {% empty %}
      <tr><td colspan="7">No orders.</td></tr>
    {% endfor %}
  </table>
</div>

<div id="menu" class="tab-content">
  <h3>Menu Management</h3>
  <p>Use admin panel to add/update items.</p>
</div>

<div id="stock" class="tab-content">
  <h3>Stock Update</h3>
  <p>Update item stock from admin.</p>
</div>

<div id="reports" class="tab-content">
  <h3>ğŸ“Š Reports</h3>
  <div style="margin-top: 20px;">
    <a href="{% url 'vendor_daily_sales' %}" class="btn" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
      ğŸ“Š Daily Sales Report
    </a>
  </div>
  <p style="margin-top: 15px; color: #666;">View detailed daily sales analytics, revenue breakdown, and export reports.</p>
</div>

<div id="profile" class="tab-content">
  <h3>Profile</h3>
  <div class="profile-card">
    <p><strong>Name:</strong> {{ profile.user.username }}</p>
    <p><strong>Email:</strong> {{ profile.user.email }}</p>
  </div>
</div>

<script>
function showTab(tabId) {
    console.log('Switching to tab:', tabId);
    
    // Remove active from all
    document.querySelectorAll('.tab-content').forEach(function(content) {
        content.classList.remove('active');
    });
    
    document.querySelectorAll('.tab-btn').forEach(function(btn) {
        btn.classList.remove('active');
    });
    
    // Add active to selected
    var selectedTab = document.getElementById(tabId);
    if (selectedTab) {
        selectedTab.classList.add('active');
        console.log('Tab activated:', tabId);
    }
    
    // Add active to button
    if (window.event && window.event.target) {
        window.event.target.classList.add('active');
    }
}
</script>
{% endblock %}