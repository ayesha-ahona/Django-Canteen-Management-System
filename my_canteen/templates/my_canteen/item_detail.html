{% extends "my_canteen/base.html" %}
{% block content %}

<div class="item-detail-container">
  <div class="item-image">
    {% if item.image %}
      <img src="{{ item.image.url }}" alt="{{ item.name }}">
    {% else %}
      <img src="https://via.placeholder.com/400x250" alt="Food">
    {% endif %}
  </div>

  <div class="item-info">
    <h2>{{ item.name }}</h2>
    <div class="item-price">{{ item.price }} Tk</div>
    <div class="item-rating">
      ‚≠ê {{ avg_rating }} / 5 ({{ total_reviews }} reviews)
    </div>
    <div class="item-description">{{ item.description }}</div>

    {% if item.stock > 0 %}
      <a href="{% url 'add_to_cart' item.id %}">
        <button class="btn">Add to Cart</button>
      </a>
    {% else %}
      <p class="out-of-stock">Out of Stock</p>
    {% endif %}
  </div>
</div>

<div class="feedback-section">
  <h3>üí¨ Customer Feedback</h3>

  {% for r in reviews %}
  <div class="review-card">
    <strong>{{ r.user.username }}</strong>
    <span class="review-rating">‚≠ê {{ r.rating }}</span>
    <p class="review-text">{{ r.comment }}</p>
    <p class="review-date">{{ r.created_at|date:"M d, Y" }}</p>
  </div>
  {% empty %}
  <p>No reviews yet. Be the first to review!</p>
  {% endfor %}

  {% if can_review %}
  <hr class="divider">
  <form method="POST" action="{% url 'submit_review' item.id %}" class="review-form">
    {% csrf_token %}
    <label>Rating (1‚Äì5):</label>
    <input type="number" name="rating" min="1" max="5" required>
    <label>Comment:</label>
    <textarea name="comment" rows="3" required></textarea>
    <button class="btn">Submit Review</button>
  </form>
  {% elif already %}
  <p style="color:green;">‚úÖ You already submitted a review for this item.</p>
  {% elif not user.is_authenticated %}
  <p>Please <a href="{% url 'login' %}">login</a> to leave a review.</p>
  {% endif %}
</div>

{% endblock %}